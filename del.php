<?php
include "inc/head.php"; // Подключаем файл с заголовком
AutorizeProtect(); // Проверяем авторизацию пользователя
global $connect; // Используем глобальную переменную для подключения к базе данных
global $usr; // Используем глобальную переменную для информации о пользователе

// Получаем ID и адрес из GET параметров
$id = e(h($_GET['id'])); // Обрабатываем ID для безопасности
$adress = e(h($_GET['adress'])); // Обрабатываем адрес для безопасности

// Формируем дату и данные для лога
$date = date("d.m.Y H:i:s"); // Получаем текущую дату и время
$user = $usr['name']; // Получаем имя пользователя
$log = "Пользователь $user удалил дом с id $id"; // Формируем сообщение для лога

// Записываем в лог
$zap = "INSERT INTO navigard_log (kogda, log) VALUES ('$date', '$log')"; // SQL запрос для вставки лога
if ($connect->query($zap) === false) { // Выполняем запрос и проверяем на ошибки
    echo $connect->error; // Выводим ошибку, если запрос не удался
}

// Удаляем запись из базы
$sql = "DELETE FROM navigard_adress WHERE id = '$id'"; // SQL запрос для удаления записи
if (mysqli_query($connect, $sql)) { // Выполняем запрос и проверяем на успех
    red_index("all?id=ok"); // Перенаправляем на страницу с подтверждением
    exit; // Завершаем выполнение скрипта
} else {
    echo "Error deleting record: " . mysqli_error($connect); // Выводим ошибку, если запрос не удался
}

mysqli_close($connect); // Закрываем соединение с базой данных
include 'inc/foot.php'; // Подключаем файл с подвалом